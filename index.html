<!doctype html>
<html>
  <head>
    <script>

let N = [
// column: 直排
// row: 橫排
// 0  1  2  3
  [0, 0, 0, 0], // 0  N[0][0], N[0][1], N[0][2], N[0][3]
  [0, 0, 0, 0], // 1  N[1][0], N[1][1], N[1][2], N[1][3]
  [0, 0, 0, 0], // 2  N[2][0], N[2][1], N[2][2], N[2][3]
  [0, 0, 0, 0], // 3  N[3][0], N[3][1], N[3][2], N[3][3]
]

function print () {
  let output = ''
  for (const n of N) {
    output += n.join(', ') + "\n"
  }
  console.log(output)
}

function mergeUp () {
  // 一個直排 A[0] A[1] A[2] A[3]
  // -> 四個直排
  //    0 號直排：N[0][0] N[1][0] N[2][0] N[3][0]
  //    1 號直排：N[0][1] N[1][1] N[2][1] N[3][1]
  //    2 號直排：N[0][2] N[1][2] N[2][2] N[3][2]
  //    3 號直排：N[0][3] N[1][3] N[2][3] N[3][3]
  for (let c = 0; c < 4; c = c + 1) {
    for (let r = 0; r < 3; r = r + 1) {
      if (N[r][c] === N[r + 1][c]) {
        N[r][c] = N[r][c] + N[r][c]
        N[r + 1][c] = 0
      }
    }
  }
}

function mergeDown () {
  for (let c = 0; c < 4; c = c + 1) {
    for (let r = 3; r > 0; r = r - 1) {
      if (N[r][c] === N[r - 1][c]) {
        N[r][c] = N[r][c] + N[r][c]
        N[r - 1][c] = 0
      }
    }
  }
}

function mergeLeft () {
  for (let r = 0; r < 4; r = r + 1) {
    for (let c = 0; c < 3; c = c + 1) {
      if (N[r][c] === N[r][c + 1]) {
        N[r][c] = N[r][c] + N[r][c]
        N[r][c + 1] = 0
      }
    }
  }
}

function mergeRight () {
  for (let r = 0; r < 4; r = r + 1) {
    for (let c = 3; c > 0; c = c - 1) {
      if (N[r][c] === N[r][c - 1]) {
        N[r][c] = N[r][c] + N[r][c]
        N[r][c - 1] = 0
      }
    }
  }
}

function moveUp () {
  // 1. 找到第一個空的 -> target
  // 2. 按順序找所有不是空的，看是否需要移到動到 target
  //    如果有移動的話，target = target + 1
  for (let c = 0; c < 4; c = c + 1) {
    let target = null
    for (let r = 0; r < 4; r = r + 1) {
      let n = N[r][c]
      if (n === 0 && target === null) target = r
      if (n > 0 && target !== null) {
        N[target][c] = N[r][c]
        N[r][c] = 0
        target = target + 1
      }
    }
  }
}

function moveDown () {
  for (let c = 0; c < 4; c = c + 1) {
    let target = null
    for (let r = 3; r >= 0; r = r - 1) {
      let n = N[r][c]
      if (n === 0 && target === null) target = r
      if (n > 0 && target !== null) {
        N[target][c] = N[r][c]
        N[r][c] = 0
        target = target + 1
      }
    }
  }
}

function moveLeft () {
  for (let r = 0; r < 4; r = r + 1) {
    let target = null
    for (let c = 0; c < 4; c = c + 1) {
      let n = N[r][c]
      if (n === 0 && target === null) target = c
      if (n > 0 && target !== null) {
        N[r][target] = N[r][c]
        N[r][c] = 0
        target = target + 1
      }
    }
  }
}

function moveRight () {
  for (let r = 0; r < 4; r = r + 1) {
    let target = null
    for (let c = 3; c >= 0; c = c - 1) {
      let n = N[r][c]
      if (n === 0 && target === null) target = c
      if (n > 0 && target !== null) {
        N[r][target] = N[r][c]
        N[r][c] = 0
        target = target - 1
      }
    }
  }
}

function isFull () {
  for (let r = 0; r < 4; r = r + 1) {
    for (let c = 0; c < 4; c = c + 1) {
      if (N[r][c] === 0) {
        return false
      }
    }
  }
  return true
}

function isMergeable () {
  // 寫在一起
  for (let r = 0; r < 4; r = r + 1) {
    for (let c = 0; c < 4; c = c + 1) {
      // 檢查左右相鄰是否有值且相同
      if (c + 1 < 4 && N[r][c] > 0 && N[r][c] === N[r][c + 1]) {
        return true
      }

      // 檢查上下相鄰是否有值且相同
      if (r + 1 < 4 && N[r][c] > 0 && N[r][c] === N[r + 1][c]) {
        return true
      }
    }
  }

  /*
  // 分開寫：檢查左右相鄰是否有值且相同
  for (let r = 0; r < 4; r = r + 1) {
    for (let c = 0; c < 3; c = c + 1) {
      if (N[r][c] > 0 && N[r][c] === N[r][c + 1]) {
        return true
      }
    }
  }

  // 分開寫：檢查上下相鄰是否有值且相同
  for (let r = 0; r < 3; r = r + 1) {
    for (let c = 0; c < 4; c = c + 1) {
      if (N[r][c] > 0 && N[r][c] === N[r + 1][c]) {
        return true
      }
    }
  }
  */

  return false
}

function isGameover () {
  return isFull() && !isMergeable()
}

window.onkeydown = function (e) {
  if (isGameover()) return
  if (e.code === 'ArrowUp') {
    moveUp()
    mergeUp()
    moveUp()
    print()
  } else if (e.code === 'ArrowDown') {
    moveDown()
    mergeDown()
    moveDown()
    print()
  } else if (e.code === 'ArrowLeft') {
    moveLeft()
    mergeLeft()
    moveLeft()
    print()
  } else if (e.code === 'ArrowRight') {
    moveRight()
    mergeRight()
    moveRight()
    print()
  }
}
    </script>
  </head>
  <body>
    2048
  </body>
</html>
